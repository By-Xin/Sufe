# 聚类分析

## 基本概念

- 聚类类型
  - R型：对变量进行聚类
  - Q性：对样本进行聚类
- 变量类型
  - 定量变量
    - 间隔变量（如长度、重量、速度）
  - 定性变量/属性变量/分类变量
    - 有序变量（如排名、等级）
    - 名义变量（如性别、型号）
- 相似性的度量方法
  - 距离
    - 距离的一般定义：对于两个样本$x=(x_1,\cdots,x_p),y=(y_1,\cdots,y_p)$
      - 非负性: $d(x,y)\ge 0$
      - 对称性: $d(x,y) = d(y,x)$
      - 三角不等式: $d(x,y) le d(x,z)+d(z,y)$
    - Minkov 距离
      - 相当于范数的概念
      - 当数据之间的差异较大或单位不统一时注意进行标准化（减均值除方差）
    - 兰氏距离
      - 定义
      $$d(x,y)=\sum_i^p \frac{|x_i-y_i|}{x_i+y_i}$$
      - 要求数据皆为正数
      - 该距离与单位无关，适用于高度偏斜/含异常值数据
    - Markov距离
      - 定义
      $$d(x,y) = \sqrt[]{(x-y)'S^{-1}(x-y)}$$
  - 相似系数
    - 相似系数的一般性质
      - 当$x,y$线性相关时$\rho=1$
      - $\forall x,y, |\rho_{x,y}| \le 1$
      - $\forall x,y, \rho_{x,y} = \rho_{y,x}$
    - 夹角余弦
      - 定义
      $$cos(\theta)=\frac{x'y}{||x||||y||}$$
    - 相关系数$\rho$
      - 对于一个标准化的数据，夹角余弦等于相关系数

## 系统聚类法/层次聚类法

### 概述

- 适用于样品数目n不是非常大的情形
- 聚类法：开始各自为一类，依次将距离较近的两两合并，直到最终合并成一类
- 分割法：最开始为一大类，不断分割为尽可能远离的两个子类

### 聚类法的详细构造方法

- 关键在于充分运用样品的距离矩阵$D^{(k)}$，详见例6.3.1等，很有可能进行考察

#### 最短距离法

- 定义类与类之间的距离为**两类最近样品**间的距离
- 最短距离法**不适合**对**分离得很差的群体**进行聚类

#### 最长距离法
  
- 定义类与类之间的距离为**两类最远样品**间的距离
- 最长距离法容易被异常值严重地扭曲

#### 类平均法

- 定义类与类之间的距离为类与类之间样本全部两两配对得到的距离之和/平方和的平均
$$D_{KL}=\frac{1}{n_Kn_L}\sum_{i\in G_K,j\in G_L} d_{ij}\\D^2_{KL}=\frac{1}{n_Kn_L}\sum_{i\in G_K,j\in G_L} d^2_{ij}$$
- 较好地利用了所有样品之间的信息，较为常用

#### 重心法

- 定义类与类之间的距离为每个类重心（均值）之间的距离
$$D_{KL}=(\bar x_K-\bar x_L)'(\bar x_K-\bar x_L)$$
- 重心法在处理**异常值**方面更**稳健**，但在其他一般情况下效果欠佳

#### Ward法（离差平方和法）

- 首先定义**类的离差平方和**$W_K$，即类中各点到重心的欧式距离平方和
  $$W_K = \sum_{i\in G_K} (x_i-\bar x_K)'(x_i-\bar x_K)$$
- Ward法合并的两类$A,B$使得合并前后的离差平方和ESS增量最小，即
  $$\{A,B\}=\argmin_{A,B}\Delta ESS = \argmin_{A,B}[ESS_{A\cup B}-(ESS_A+ESS_B)]$$
- 离差平方和倾向于将一些规模较小的类进行合并，这是较为理想的性质

#### 系统聚类法的单调性

- 单调性是指在聚类过程中，后合并的类之间的距离一定不小于先合并的类；即**先合并较相似的类**，后合并较疏远的类。
- **重心法**和中间距离法不具有单调性，其余都具有单调性

#### 对变量的聚类（R型）

- 最短距离法、最长距离法和类平均法可以R型聚类

## 动态聚类法

- 系统聚类中，已经完成聚类的类将被固定不再被调整；而动态聚类法可以调整
- 动态聚类的计算复杂度要远小于系统聚类，因此能够分析更大规模的数据
- 动态聚类需要事先**给定**需要分成的**类的个数**
- 动态聚类**只能进行样本聚类（Q型）**

### k-means

- 基本步骤
  1. 选择$k$个初始样本作为凝聚点/随机分成$k$类并取各自重心作为凝聚点
  2. 对所有样本逐个遍历，将每个样本归入离其最近（通常可以用欧式距离衡量远近）的类中
  3. 每一类的凝聚点都更新为目前类中各点的均值（重心）
  4. 重复上述步骤直到所有的样本都不再更新（稳定收敛）为止

- 最终的聚类结果在一定程度上**依赖于初始凝聚点**或初始分类的选择